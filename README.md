# Проектная работа "Веб-ларек"

https://github.com/piierro/web-larek-frontend.git

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

* src/ — исходные файлы проекта
* src/components/ — папка с JS компонентами
* src/components/base/ — папка с базовым кодом

Важные файлы:

* src/pages/index.html — HTML-файл главной страницы
* src/types/index.ts — файл с типами
* src/index.ts — точка входа приложения
* src/scss/styles.scss— корневой файл стилей
* src/utils/constants.ts — файл с константами
* src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

## Сборка

```
npm run build
```

## Описание типов данных

* ```IProductItem``` - интерфейс описывающий структуру данных продукта, включает в себя: id, описание, URL изображения, название, категорию и стоимость товара.
* ```IAppState ```-  интерфейс для типов общего стостояния приложения(содержит состояние корзины, каталога товаров и заказа.).
* ```IOrderForm``` -  интерфейс для указания атрибутов формы заказа, включает в себя данные: адреса доставки, способа оплаты, электронную почту и номер телефона.
* ```IOrder``` - типизирует объект, который представляет собой заказ и содержит следующие данные:
    1. `items` - массив строк, представляющий товары в заказе.
    2. `total` - число, обозначающее общую стоимость заказа.
* ```IOrderResult``` - интерфейс для результата оформления заказа.

## Базовый код

1. Класс ```EventEmitter``` обеспечивает работу событий. 
   * on - устанавливает обработчик на событие.
   * off - снимает обработчик с события.
   * emit - инициирует событие с данными.
   * onAll - устанавливает обработчик на все события.
   * offAll - снимает обработчик со всех событий.
   * trigger - устанавливает триггер, генерирующий событие при вызове.

2. Класс ```Api``` используется для взаимодействия с внешними системами.
   * возможность отправлять GET и POST-запросы;

3. Класс ```Component``` является базовым классом для компонентов представления.
   Методы:

   * toggleClass - переключает класс элемента.
   * setText - устанавливает текстовое содержание.
   * setDisabled - меняет статус блокировки элемента.
   * setHidden - скрывает элемент.
   * setVisible - показывает элемент.
   * setImage - устанавливает изображение с альтернативным текстом.
   * render- возвращает корневой DOM-элемент.

4. Класс ```Model``` базовый класс для создания классов моделей данных.
   * `emitChanges` - сообщает всем, что модель изменилась

## Компоненты модели данных

 ```AppData``` реализует работу с моделью приложения.

 **Класс `AppState`**: - Хранит глобальное состояние приложения, включая информацию о корзине, каталоге продуктов, заказе и ошибках формы.
   - Содержит методы для работы с данными, такие как расчет общей суммы корзины, установка каталога продуктов, добавление/удаление продуктов в корзину, очистка корзины, а также валидация контактной информации и заказа:
     * getTotal() - отдаёт сумму товаров из корзины
     * setCatalog() - создаёт массив карточек товаров;
     * addToBasket() - добавляет товар в корзину
     * removeFromBusket() - удаляет товар из корзины
     * clearBasket() - очищает корзину
     * clearOrder() - очищает данные текущего заказа
     * checkProduct() - проверяет наличие товара в корзине
     * setOrderField() - заполняет данные формы в заказ (тип оплаты, адрес)
     * validateOrder() - проверяет валидацию типа оплаты и адреса
     * setContactField() - заполняет данные формы в заказ ( email, телефон)
     * validateContact() - проверяет данные почты и телефона


- Cвойства:
  `basket: IProductItem[] = [] - хранит список товаров в корзине;`
  `catalog: IProductItem[] - хранит данные о товарах;`
  `order: IOrder = { - хранит данные о заказе`
    `email: '',`
    `phone: '',`
    `items: [],`
    `payment: '',`
    `total: 0,`
    `address: ''`
  };
    
  `formErrors: FormErrors = {} - хранение ошибок валидации;`


## Представление

### Класс `Page` - для управления отображения каталога товаров, счётчика корзины, блокировка прокрутки. 

- Класс `Page` является наследником класса `Component<IPage>`.
- Поля класса:
  - `_counter`: элемент счетчика корзины.
  - `_catalog`: элемент каталога.
  - `_wrapper`: обертка страницы.
  - `_basket`: элемент корзины.

- Для изменения значений в полях класса используются следующие сеттеры:
  - `counter`: устанавливает значение счетчика в корзине, обновляя текст элемента.
  - `catalog`: добавляет карточки на страницу, заменяя текущие элементы.

  Метод `locked`: блокирует/разблокирует прокрутку страницы путем добавления/удаления класса.

Этот класс предоставляет архитектуру компонента страницы (Page) с базовым функционалом управления элементами на странице.


### Класс `Card` - для отображения карточки товара.

- Класс `Card` является наследником класса `Component<ICard>`.
- Поля класса:
  - `_title`: элемент заголовка карточки.
  - `_image`: элемент изображения.
  - `_description`: элемент описания.
  - `_button`: элемент кнопки.
  - `_category`: элемент категории карточки.
  - `_price`: элемент цены.
  
- Для изменения значений в полях класса используются следующие сеттеры:
  - `id`: устанавливает значение идентификатора для данных карточки.
  - `title`: устанавливает или возвращает текст заголовка карточки.
  - `image`: устанавливает изображение для карточки.
  - `description`: устанавливает текст описания карточки.
  - `category`: устанавливает текст категории и добавляет соответствующий класс категории.
  - `price`: устанавливает текст цены карточки (или текст 'Бесценно' для null значения).

Этот класс предоставляет компонент карточки (Card) с возможностью управления текста, изображения, описания, категории и ценой карточки.

### Класс `Modal` -  для отображения модального окна.

- Класс `Modal` является наследником класса `Component<IModalData>`.
- Поля класса:
  - `_closeButton`: кнопка закрытия модального окна.
  - `_content`: содержимое модального окна.
  
- Добавляются слушатели событий 'click' на кнопку закрытия, на сам контейнер модального окна для закрытия и на содержимое модального окна для предотвращения закрытия.
  
- Свойства класса:
  - `content`: устанавливает содержимое модального окна, заменяя текущее содержимое.
  
- Методы класса:
  - `open()`: открывает модальное окно.
  - `close()`: закрывает модальное окно.
  - `render(data: IModalData)`: рендерит модальное окно с заданными данными, открывая его сразу после рендеринга.

Этот класс предоставляет управление модальным окном (Modal) с возможностью открытия, закрытия и установки контента.


 ### Класс `Form` - для отображения формы. 

- Класс `Form<T>` представляет форму и управление ее состоянием.
- Класс наследуется от `Component<IFormState>`.
- Поля класса:
  - `_submit`: кнопка отправки формы.
  - `_errors`: элемент для отображения ошибок формы.
  
- Методы класса:
  - `onInputChange(field: keyof T, value: string)`: обрабатывает событие изменения в поле формы и генерирует событие изменения для конкретного поля.
  
- Свойства класса:
  - `valid`: устанавливает доступность кнопки отправки формы в зависимости от валидности формы.
  - `errors`: устанавливает текст ошибок формы для отображения.
  
- Метод `render(state: Partial<T> & IFormState)`: генерирует разметку на основании полученных в параметр state данных, обновляя валидность, ошибки и другие входные данные. 

Этот класс предoставляет компонент формы (Form) с возможностью управления состоянием и взаимодействия событиями. 


### Класс `Success` - для отображения элемента при успешной оплате заказа.

- Класс `Success` представляет компонент для отображения успешного завершения действия.
- Класс является наследником `Component<ISuccess>`.
- Поля класса:
  - `_close`: элемент для закрытия сообщения об успешном завершении.
  - `_total`: отрисовывает общую сумму списания.

Этот класс предоставляет компонент успешного завершения (Success) с функционалом отображения общего количества и возможностью выполнения дополнительных действий при клике на элемент закрытия.


### Класс `Basket` - для отображения корзины.

- Класс `Basket` представляет компонент корзины товаров.
- Класс является наследником `Component<IBasketView>`.
- Поля класса:
  - `_list`: элемент списка товаров в корзине.
  - `_total`: элемент для отображения общей суммы товаров в корзине.
  - `_button`: элемент кнопки для открытия оформления заказа.
  
- Свойства oбъекта:
  - `items` (массив `HTMLElement`): устанавливает список элементов товаров в корзине, обновляя содержимое в `_list`.
  - `selected`: управляет доступностью кнопки.
  - `total`: устанавливает и отображает общую сумму товаров в корзине в элементе.

Этот класс предоставляет компонент корзины (Basket) с возможностью управления товарами, отображения общей суммы и обработки выбранных элементов.


### Класс `Contacts` - для отображения формы ввода почты и телефона.

- Класс `Contacts` расширяет класс `Form<IOrderForm>` и представляет компонент контактной информации.
- Свойства класса:
  - `phone`: устанавливает значение номера телефона.
  - `email`: устанавливает значение электронной почты.

### Класс `Order` -  для отображения формы выбора оплаты и ввода адреса.

- Класс `Order` также расширяет класс `Form<IOrderForm>` и представляет компонент для оформления заказа.
- Поля класса:
  - `_buttons`: массив кнопок в форме выбора способа оплаты.
- Для каждой кнопки добавляется слушатель события 'click', который устанавливает способ оплаты и эмитирует событие изменения способа оплаты.
- Свойства класса:
  - `payment`: устанавливает выбранный способ оплаты и применяет соответствующий стиль к кнопке.
  - `address`: устанавливает значение адреса.

Эти классы предоставляют компоненты для ввода контактной информации (Contacts) и оформления заказа (Order) с возможностью управления полями формы и выбора способа оплаты.


### Интерфейс IProductAPI

- Интерфейс IProductAPI определяет методы для взаимодействия с API относительно продуктов.
- Методы:
  - getCardList: получение списка продуктов в виде массива товаров.
  - orderCards: оформление заказа с передачей информации о заказе и получение результата заказа.

### Класс ProductAPI - для взаимодействие с сервером.

- Класс ProductAPI реализует интерфейс IProductAPI и предоставляет методы для работы с продуктами через API, наследуя функционал от базового класса Api.
- Методы класса:
  - getCardList(): выполняет GET-запрос на сервер для получения списка продуктов и обработки данных.
  - orderCards(order: IOrder): выполняет POST-запрос на сервер для оформления заказа и получения результата.

Этот класс представляет API для взаимодействия с продуктами, включая получение списка продуктов и заказ товаров.

### Презентеры 

Слой презентера не выделен в отдельный класс и реализован в index.ts. В приложении применен событийно-ориентированный подход. Для генерации событий и установки слушателей на события используется инстант класса EventEmitter, отвечающего за работу с событиями в приложении. При возникновении события выполняется обработчик, в котором реализованы логика приложения и взаимодействие между моделью (данными) и представлением (отображением). В приложении используются следующие события:
   
   Основные события:

   * items:changed - изменение каталога товаров.
   * card:select - нажатие на карточку товара.
   * preview:changed - открытие карточки товара.
   * basket:open - открытие корзины.
   * basket:changed - изменение содержимого корзины.
   * card:add - добавление карточки.
   * card:remove - удаление карточки.
   * formErrorsContact:change - изменение состояния валидации формы контактов.
   * order:submit - открытие формы контактов.
   * formErrorsOrder:change - изменение состояния валидации формы заказа.
   * order:open - открытие формы заказа.
   * payment:change - изменение типа оплаты.
   * contacts:submit - успешная оплата заказа.
   * modal:open - открытие модального окна.
   * modal:close - закрытие модального окна.
   * /^order..*:change/ - изменение полей в форме заказа.
   * /^contacts..*:change/ - изменение полей в форме контактов.

